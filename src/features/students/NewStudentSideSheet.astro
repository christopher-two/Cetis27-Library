---
import SideSheet from "../../components/ui/SideSheet.astro";
import TextField from "../../components/ui/TextField.astro";
import Button from "../../components/ui/Button.astro";
---

<SideSheet id="new-student-sidesheet" title="Registrar Nuevo Alumno">
  <form class="flex flex-col gap-8" id="new-student-form">
    <div class="flex flex-col gap-5">
      <TextField
        label="Matrícula"
        placeholder="Ej. 20241050"
        required
        id="student-matricula"
      />

      <div class="grid grid-cols-1 gap-5">
        <TextField
          label="Nombre Completo"
          placeholder="Ej. Juan Pérez"
          required
          id="student-name"
        />
        <TextField
          label="Correo Institucional"
          type="email"
          placeholder="Ej. juan.perez@edu.mx"
          required
          id="student-email"
        />
      </div>

      <div class="flex flex-col gap-2">
        <label
          class="text-sm font-medium text-[var(--m3-sys-on-surface-variant)] ml-1"
          >Carrera / Grado</label
        >
        <select
          id="student-career"
          class="w-full px-4 py-3 rounded-[var(--m3-radius-lg)] border border-[var(--m3-sys-outline)] bg-[var(--m3-sys-surface)] text-[var(--m3-sys-on-surface)] outline-none focus:border-[var(--m3-sys-primary)] transition-all"
        >
          <option value="" disabled selected>Selecciona una opción</option>
          <option value="isi">Ingeniería en Sistemas</option>
          <option value="ind">Ingeniería Industrial</option>
          <option value="admin">Administración</option>
          <option value="other">Otro</option>
        </select>
      </div>
    </div>

    <div class="flex flex-col gap-3 mt-4">
      <Button md-type="submit" class="w-full !py-4 shadow-lg text-base"
        >Guardar Alumno</Button
      >
      <Button
        variant="text"
        md-type="button"
        onclick="window.closeNewStudentSidesheet()"
        class="w-full">Cancelar</Button
      >
    </div>
  </form>
</SideSheet>

<script>
  import { addStudent } from "../../services/firebase/students";

  const form = document.getElementById("new-student-form");

  form?.addEventListener("submit", async (e) => {
    e.preventDefault();

    const matricula = (
      document.getElementById("student-matricula") as HTMLInputElement
    ).value;
    const name = (document.getElementById("student-name") as HTMLInputElement)
      .value;
    const email = (document.getElementById("student-email") as HTMLInputElement)
      .value;
    const career = (
      document.getElementById("student-career") as HTMLSelectElement
    ).value;

    try {
      await addStudent({
        matricula,
        name,
        email,
        career,
        status: "active",
      });
      // @ts-ignore
      window.closeNewStudentSidesheet();
      (e.target as HTMLFormElement).reset();
    } catch (error) {
      console.error("Error adding student:", error);
      alert("Error al guardar alumno.");
    }
  });
</script>
