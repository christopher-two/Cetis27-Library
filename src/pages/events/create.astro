---
import Layout from "../../layouts/Layout.astro";
import EventForm from "../../features/events/EventForm.astro";
import Sidebar from "../../components/Sidebar.astro";
import MobileHeader from "../../components/MobileHeader.astro";
---

<Layout title="Crear Evento - Biblioteca Digital">
  <div
    class="flex flex-col lg:flex-row min-h-screen bg-[var(--m3-sys-light-surface)]"
  >
    <MobileHeader />
    <Sidebar />
    <main
      class="flex-1 p-4 lg:p-8 h-auto lg:h-screen overflow-y-auto overflow-x-hidden"
    >
      <EventForm />
    </main>
  </div>
</Layout>

<script>
  import { auth } from "../../lib/firebase";
  import { onAuthStateChanged } from "firebase/auth";
  import { doc, getDoc, getFirestore } from "firebase/firestore";

  const db = getFirestore();

  // Basic client-side admin check (Server-side rules still enforce security)
  onAuthStateChanged(auth, async (user) => {
    if (!user) {
      window.location.href = "/login";
      return;
    }

    const userDoc = await getDoc(doc(db, "users", user.uid));
    if (!userDoc.exists() || userDoc.data().role !== "admin") {
      alert("No tienes permisos para acceder a esta p√°gina");
      window.location.href = "/dashboard";
    }
  });
</script>
